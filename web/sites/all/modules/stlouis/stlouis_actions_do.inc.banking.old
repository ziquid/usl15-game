<?php

/**
 * @file stlouis_actions_do.inc.banking.old
 * Includes for banking functions (unmaintained, no longer used).
 */


function _stlouis_action_open_a_bank_account_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
  $can_do_again = FALSE;

  $password = trim(check_plain($_GET['password']));

  // Need a password.
  if (empty($password)) {

    $outcome_reason =<<< EOF
<div class="ask-clan-name">
<form method=get action="/$game/actions_do/$arg2/$action_id">
  <p>Please enter a password for your new account</p>
  <p class="second">Anyone with your account number and password can
    deposit or withdraw</p>
  <input type="text" name="password" size="20" maxlength="20"/>
  <input type="submit" value="Submit"/>
</form>
</div>
EOF;

    return FALSE;

  }

  // Generate an account number.
  $account_num = 0;

  while ($account_num == 0) {

    $account_num = mt_rand(100000000, 999999999); // 9 digits
    $sql = 'select account_number from bank_accounts
      where account_number = %d;';
    $result = db_query($sql, $account_num);
    $item = db_fetch_object($result);
firep($item);

    // Account number already exists.
    if (!empty($item)) {
      $account_num = 0;
    }

  }

  // Doesn't exist - create it!
  $sql = 'insert into bank_accounts (fkey_users_id, account_number, password)
    values (%d, %d, "%s");';
  $result = db_query($sql, $game_user->id, $account_num, $password);

//    mail('joseph@cheek.com', 'bank account ' . $account_num . ' created',
//      $game_user->username . ' opened it.');

  $outcome_reason .=<<< EOF
<div class="action-effect">
Your account number is <span class="account-num">$account_num</span>.
</div>
<div class="action-effect">
Your password is <span class="account-num">$password</span>.
</div>
<div class="action-effect">
Please write these down!
</div>
EOF;

  return TRUE;

}


function _stlouis_action_close_a_bank_account_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
  $can_do_again = FALSE;

  $account_num = trim(check_plain($_GET['account_num']));
  $password = trim(check_plain($_GET['password']));

  if (empty($password) || empty($account_num)) {

    // Need an account number and password.

    $outcome_reason =<<< EOF
<div class="ask-clan-name">
<form method=get action="/$game/actions_do/$arg2/$action_id">
  <p>Please enter your account number and password</p>
  Account #: <input type="text" name="account_num" size="9" maxlength="9"/>
  <br/>
  Password: <input type="text" name="password" size="20" maxlength="20"/>
  <br/>
  <input type="submit" value="Submit"/>
</form>
</div>
EOF;

    return FALSE;

  }

  // Validate the info.
  $sql = 'select * from bank_accounts
    where account_number = %d
    and password = "%s"
    and fkey_users_id = %d
    and active = 1;';
  $result = db_query($sql, $account_num, $password, $game_user->id);
  $item = db_fetch_object($result);
firep($item);

  // Account info not correct.
  if (empty($item)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We cannot find an open account in
      your name with that account number and password.</div>';

    return FALSE;

  }

  // Close the account.
  $sql = 'update bank_accounts
    set timestamp_closed = CURRENT_TIMESTAMP, active = 0, balance = 0
    where id = %d;';
  $result = db_query($sql, $item->id);
  $sql = 'update users
    set money = money + %d
    where id = %d;';
  $result = db_query($sql, $item->balance, $game_user->id);
  $game_user->money += $item->balance;

  // No need to reprocess; automatically.
  $balance = number_format($item->balance);

  mail('joseph@cheek.com', 'bank account ' . $account_num . ' closed',
    'by ' . $game_user->username . ', who pocketed ' . $balance .
    ' ' . $game_user->values . '.');

  $outcome_reason .=<<< EOF
<div class="action-effect">
Your account is now closed and the remaining balance of $balance
$game_user->values has been given to you.
</div>
EOF;

  return TRUE;

}


function _stlouis_action_list_your_bank_accounts_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
//    $can_do_again = FALSE;

  $sql = 'select * from bank_accounts
    where fkey_users_id = %d
    and active = 1;';
  $result = db_query($sql, $game_user->id);
  while ($item = db_fetch_object($result)) $data[] = $item;

  foreach ($data as $item) {

    $balance = number_format($item->balance);
    $outcome_reason .=<<< EOF
<div class="action-effect">
Account <span class="account-num medium">$item->account_number</span> has
<span class="account-num medium">$balance</span>
$game_user->values
</div>
EOF;

  }

  if (sizeof($data) == 0)
    $outcome_reason .=<<< EOF
<div class="action-effect">No accounts found!</div>
EOF;

//    mail('joseph@cheek.com', 'bank account check', 'by ' .
//      $game_user->username . ', who has ' . sizeof($data) . ' account(s)');

  return TRUE;

}


function _stlouis_action_change_a_bank_account_password_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
//    $can_do_again = FALSE;

  $account_num = trim(check_plain($_GET['account_num']));
  $password = trim(check_plain($_GET['password']));

  if (empty($password) || empty($account_num)) {

  // Need an account number and password.
    $outcome_reason =<<< EOF
<div class="ask-clan-name">
<form method=get action="/$game/actions_do/$arg2/$action_id">
  <p>Please enter the account number and the new password</p>
  Account #: <input type="text" name="account_num" size="9" maxlength="9"/>
  <br/>
  New Password: <input type="text" name="password" size="20" maxlength="20"/>
  <br/>
  <input type="submit" value="Submit"/>
</form>
</div>
EOF;

    return FALSE;

  }

  // Validate the info.
  $sql = 'select * from bank_accounts
    where account_number = %d
    and fkey_users_id = %d
    and active = 1;';
  $result = db_query($sql, $account_num, $game_user->id);
  $item = db_fetch_object($result);
firep($item);

  // Account info not correct.
  if (empty($item)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We cannot find an open account in
      your name with that account number.</div>';

    return FALSE;

  }

  // Update the password.
  $sql = 'update bank_accounts
    set password = "%s"
    where id = %d;';
  $result = db_query($sql, $password, $item->id);

//    mail('joseph@cheek.com', 'bank account ' . $account_num .
//      ' password changed', 'by ' . $game_user->username . '.');

  $outcome_reason .=<<< EOF
<div class="action-effect">
The password for account <strong>$account_num</strong>
has successfully been changed to <strong>$password</strong>.
</div>
<div class="action-effect">
The old password will no longer work for deposits or withdrawals.
</div>
EOF;

  return TRUE;

}


function _stlouis_action_deposit_funds_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
//    $can_do_again = FALSE;

  $account_num = trim(check_plain($_GET['account_num']));
//    $password = trim(check_plain($_GET['password']));
  $amount = trim(check_plain($_GET['amount']));

//    if (empty($password) || empty($account_num) || empty($amount)) {
  if (empty($account_num) || empty($amount)) {

    // Need an account number and password and amount.
    $outcome_reason =<<< EOF
<div class="ask-clan-name">
<form method=get action="/$game/actions_do/$arg2/$action_id">
  <p>Please enter the account number, password, and amount you wish to
    deposit</p>
  Account #: <input type="text" name="account_num" size="9" maxlength="9"/>
  <br/>
<!--    Password: <input type="text" name="password" size="20" maxlength="20"/>
  <br/>-->
  Amount: <input type="text" name="amount" size="10" maxlength="10"/>
  <br/>
  <input type="submit" value="Submit"/>
</form>
</div>
EOF;

    return FALSE;

  }

  // Validate the info -- first, check that the account exists.
  $sql = 'select * from bank_accounts
    where account_number = %d
--      and password = "%s"
    and active = 1;';
  $result = db_query($sql, $account_num/* , $password */ );
  $item = db_fetch_object($result);
firep($item);

  // Account info not correct.
  if (empty($item)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We cannot find an open account
      with that account number and password.</div>';

    return FALSE;

  }

  // Set transaction_lock and then reprocess user object.

  // Spin 10 times for 1 second waiting for a lock, if necessary.
  $lock_acquired = FALSE;
  $lock_try = 0;

  while ((!$lock_acquired) && ($lock_try < 10)) {

    $sql = 'select * from bank_accounts
      where account_number = %d
--        and password = "%s"
      and active = 1;';
    $result = db_query($sql, $account_num /*, $password */);
    $item = db_fetch_object($result);

    if ($item->transaction_lock == 0) {
      db_query('update bank_accounts set transaction_lock = 1
        where id = %d;', $item->id);
      $lock_acquired = TRUE;
      $lock_try = 0;
    }
    else {
      $lock_try++;
      sleep(1);
    }

  }

  // Unable to get a lock.
  if ($lock_try > 0) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We temporarily cannot access your
      account.&nbsp; Please try again later.</div>';

    return FALSE;

  }

  $game_user = zg_fetch_user();

  // Check moolah.

  // Not enough moolah.
  if (($amount > $game_user->money) || ($amount < 0)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">You do not have that much to
      deposit.</div>';

    db_query('update bank_accounts set transaction_lock = 0
      where id = %d;', $item->id);
    return FALSE;

  }

  // Next, check account.

  // Make the deposit and subtract from the user.
  $sql = 'update bank_accounts
    set balance = balance + %d
    where id = %d;';
  $result = db_query($sql, $amount * 0.8, $item->id);

  $sql = 'update users
    set money = money - %d
    where id = %d;';
  $result = db_query($sql, $amount, $game_user->id);
  $game_user->money -= $amount;
  $new_balance = number_format($item->balance + $amount * 0.8);

  $sql = 'insert into bank_account_transactions
    (fkey_users_id, fkey_bank_accounts_id, transaction_type, orig_balance,
    fkey_account_values_id, transaction_amount, fkey_transaction_values_id,
    account_currency_strength, transaction_currency_strength,
    account_currency_amount, fee_percentage, fee_amount,
    net_transaction_amount, ending_balance)

    values ($game_user->id, %d, "deposit", %d,
      (SELECT users.fkey_values_id
      FROM  `bank_accounts`
      LEFT JOIN users ON users.id = bank_accounts.fkey_users_id
      WHERE bank_accounts.account_number = %d),
    %d, %d, 1.00, 1.00, %d, 20, %d, %d, %d);';
  $result = db_query($sql, $item->id, $item->balance, $account_num,
    $amount, $game_user->fkey_values_id, $amount, $amount * 0.2,
    $amount * 0.8, $item->balance + $amount * 0.8);

/*
  mail('joseph@cheek.com', 'bank account deposit to ' . $account_num . '.',
    'by ' . $game_user->username . ', who deposited ' .
    number_format($amount) . ' less ' . number_format($amount * 0.2) .
    ' in fees.  The ' .
    'current balance in the account is now ' . $new_balance . '.');
*/

  $outcome_reason .=<<< EOF
<div class="action-effect">
Your deposit was successful!
</div>
EOF;

  // Show balance if you own it.
  if ($game_user->id == $item->fkey_users_id) {

  $outcome_reason .=<<< EOF
<div class="action-effect">
Your account balance is now $new_balance $game_user->values.
</div>
EOF;

  }

    // Reprocess user object and then clear transaction_lock.
    db_query('update bank_accounts set transaction_lock = 0
      where id = %d;', $item->id);

  $game_user = zg_fetch_user();
  return TRUE;

}


function _stlouis_action_withdraw_funds_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . arg(0) . '_fetch_user';

  $game_user = zg_fetch_user();
  include drupal_get_path('module', 'zg') . '/includes/' . $game . '_defs.inc';
  $action_id = arg(3);
  $arg2 = check_plain(arg(2));
//    $can_do_again = FALSE;

  $account_num = trim(check_plain($_GET['account_num']));
  $password = trim(check_plain($_GET['password']));
  $amount = trim(check_plain($_GET['amount']));

  if (empty($password) || empty($account_num) || empty($amount)) {

    // Need an account number and password and amount.
    $outcome_reason =<<< EOF
<div class="ask-clan-name">
<form method=get action="/$game/actions_do/$arg2/$action_id">
  <p>Please enter the account number, password, and amount you wish to
    withdraw</p>
  Account #: <input type="text" name="account_num" size="9" maxlength="9"/>
  <br/>
  Password: <input type="text" name="password" size="20" maxlength="20"/>
  <br/>
  Amount: <input type="text" name="amount" size="10" maxlength="10"/>
  <br/>
  <input type="submit" value="Submit"/>
</form>
</div>
EOF;

    return FALSE;

  }

  // Validate the info -- first, check that the account exists.
  $sql = 'select * from bank_accounts
    where account_number = %d
    and password = "%s"
    and active = 1;';
  $result = db_query($sql, $account_num, $password);
  $item = db_fetch_object($result);
firep($item);

  // Account info not correct.
  if (empty($item)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We cannot find an open account
      with that account number and password.</div>';

    return FALSE;

  }

  // Set transaction_lock and then reprocess user object.

  // Spin 10 times for 1 second waiting for a lock, if necessary.
  $lock_acquired = FALSE;
  $lock_try = 0;

  while ((!$lock_acquired) && ($lock_try < 10)) {

    $sql = 'select * from bank_accounts
      where account_number = %d
      and password = "%s"
      and active = 1;';
    $result = db_query($sql, $account_num, $password);
    $item = db_fetch_object($result);

    if ($item->transaction_lock == 0) {
      db_query('update bank_accounts set transaction_lock = 1
        where id = %d;', $item->id);
      $lock_acquired = TRUE;
      $lock_try = 0;
    }
    else {
      $lock_try++;
      sleep(1);
    }

  }

  // Unable to get a lock.
  if ($lock_try > 0) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">We temporarily cannot access your
      account.&nbsp; Please try again later.</div>';

    return FALSE;

  }

  $game_user = zg_fetch_user();

  // Check moolah.

  // Not enough moolah.
  if (($amount > $item->balance) || ($amount < 0)) {

    $outcome_reason = '<div class="land-failed">' .
      t('Sorry!') .
      '</div><div class="action-effect">The account does not have that much to
      withdraw.</div>';

    db_query('update bank_accounts set transaction_lock = 0
      where id = %d;', $item->id);
    return FALSE;

  }

  // Make the withdrawal and add to the user.
  $sql = 'update bank_accounts
    set balance = balance - %d
    where id = %d;';
  $result = db_query($sql, $amount, $item->id);

  $sql = 'update users
    set money = money + %d
    where id = %d;';
  $result = db_query($sql, $amount, $game_user->id);
  $game_user->money += $amount;
  $new_balance = number_format($item->balance - $amount);

  $sql = 'insert into bank_account_transactions
    (fkey_users_id, fkey_bank_accounts_id, transaction_type, orig_balance,
    fkey_account_values_id, transaction_amount, fkey_transaction_values_id,
    account_currency_strength, transaction_currency_strength,
    account_currency_amount, fee_percentage, fee_amount,
    net_transaction_amount, ending_balance)

    values ($game_user->id, %d, "withdrawal", %d,
      (SELECT users.fkey_values_id
      FROM  `bank_accounts`
      LEFT JOIN users ON users.id = bank_accounts.fkey_users_id
      WHERE bank_accounts.account_number = %d),
    %d, %d, 1.00, 1.00, %d, 0, 0, %d, %d);';
  $result = db_query($sql, $item->id, $item->balance, $account_num,
    $amount, $game_user->fkey_values_id, $amount,
    $amount, $item->balance - $amount);

  // Not owned by you?
  if ($game_user->id != $item->fkey_users_id) {
    $not_owner = 'The withdrawer is not the account owner!';
  }

/*
  mail('joseph@cheek.com', 'bank account withdrawal from ' . $account_num .
    '.', 'by ' . $game_user->username . ', who withdrew ' .
    number_format($amount) . '.  The ' .
    'current balance in the account is now ' . $new_balance . '.  ' .
    $not_owner);
*/
  $outcome_reason .=<<< EOF
<div class="action-effect">
Your withdrawal was successful!
</div>
EOF;

  // Show balance if you own it.
  if ($game_user->id == $item->fkey_users_id) {

  $outcome_reason .=<<< EOF
<div class="action-effect">
Your account balance is now $new_balance $game_user->values.
</div>
EOF;

  }

    // Reprocess user object and then clear transaction_lock.
    db_query('update bank_accounts set transaction_lock = 0
      where id = %d;', $item->id);

  $game_user = zg_fetch_user();
  return TRUE;

}

function _stlouis_action_open_a_small_present_function(&$outcome_reason,
  $target, &$can_do_again) {

  $fetch_user = '_' . arg(0) . '_fetch_user';
  $game_user = zg_fetch_user();
//    $can_do_again = FALSE;


  switch(mt_rand(0, 142)) {

    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
      $money = floor(($game_user->income - $game_user->expenses) / 8);
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
      $outcome_reason .=
        '<div class="title">You got 5 actions!</div>';

      $sql = 'update users set actions = actions + 6
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
      $outcome_reason .=
        '<div class="title">You got 100 influence!</div>';

      $sql = 'update users set experience = experience + 100
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
      $outcome_reason .=
        '<div class="title">You got 500 Influence!</div>';

      $sql = 'update users set experience = experience + 500
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
      $land = 1;

      $outcome_reason .= '<div class="title">You got a deed to
        a Lemonade Stand!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 90:
    case 91:
    case 92:
    case 93:
    case 94:
    case 95:
    case 96:
    case 97:
    case 98:
    case 99:
      $land = 2;

      $outcome_reason .= '<div class="title">You got a deed to
        a Paper Route!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 100:
    case 101:
    case 102:
    case 103:
    case 104:
    case 105:
    case 106:
    case 107:
    case 108:
    case 109:
      $land = 3;

      $outcome_reason .= '<div class="title">You got a deed to an
        Online Auction Business!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 110:
    case 111:
    case 112:
    case 113:
    case 114:
    case 115:
    case 116:
    case 117:
    case 118:
    case 119:
      $equipment = 3;

      $outcome_reason .= '<div class="title">You got a Dictionary!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 1
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_equipment_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 120:
    case 121:
    case 122:
    case 123:
    case 124:
    case 125:
    case 126:
    case 127:
    case 128:
    case 129:
      $equipment = 10;

      $outcome_reason .= '<div class="title">You got a Political Flyer!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 1
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_equipment_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 130:
    case 131:
    case 132:
    case 133:
    case 134:
    case 135:
    case 136:
    case 137:
    case 138:
    case 139:
      $equipment = 11;

      $outcome_reason .= '<div class="title">You got a Political Button!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 1
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_eqiupment_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 140:
      $land = 10;

      $outcome_reason .= '<div class="title">You got a deed to a
        Bank!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 141:
      $land = 11;

      $outcome_reason .= '<div class="title">You got a deed to a
        Luxury Car Importer!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 142:
      $land = 12;

      $outcome_reason .= '<div class="title">You got a deed to a
        Manufacturing Plant!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    default:
      $money = $game_user->level * 100;
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

  }

  return TRUE;

}


function _stlouis_action_open_a_medium_present_function(&$outcome_reason,
  $target, &$can_do_again) {

  $fetch_user = '_' . arg(0) . '_fetch_user';
  $game_user = zg_fetch_user();
//    $can_do_again = FALSE;


  switch(mt_rand(30, 145)) {

/*
    case 30:
    case 31:
    case 32:
    case 33:
    case 34:
    case 35:
    case 36:
    case 37:
    case 38:
    case 39:
      $outcome_reason .=
        '<div class="title">You got your energy refilled!</div>';

      $sql = 'update users set energy = energy_max
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;
*/
    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
      $money = floor(($game_user->income - $game_user->expenses) / 2);
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
      $outcome_reason .=
        '<div class="title">You got 20 actions!</div>';

      $sql = 'update users set actions = actions + 21
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
      $outcome_reason .=
        '<div class="title">You got 1000 influence!</div>';

      $sql = 'update users set experience = experience + 1000
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
    case 75:
    case 76:
    case 77:
    case 78:
    case 79:
      $outcome_reason .=
        '<div class="title">You got 2500 Influence!</div>';

      $sql = 'update users set experience = experience + 2500
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
      $land = 4;

      $outcome_reason .= '<div class="title">You got a deed to
        a Pool Hall!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 90:
    case 91:
    case 92:
    case 93:
    case 94:
    case 95:
    case 96:
    case 97:
    case 98:
    case 99:
      $land = 5;

      $outcome_reason .= '<div class="title">You got a deed to
        a Woodworking Shop!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 100:
    case 101:
    case 102:
    case 103:
    case 104:
    case 105:
    case 106:
    case 107:
    case 108:
    case 109:
      $land = 6;

      $outcome_reason .= '<div class="title">You got a deed to a
        Restaurant!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 110:
    case 111:
    case 112:
    case 113:
    case 114:
    case 115:
    case 116:
    case 117:
    case 118:
    case 119:
      $equipment = 4;

      $outcome_reason .= '<div class="title">You got 10 Thesauruses!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 10
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_equipment_id, fkey_users_id, quantity) values
          (%d, %d, 10);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 120:
    case 121:
    case 122:
    case 123:
    case 124:
    case 125:
    case 126:
    case 127:
    case 128:
    case 129:
      $staff = 1;

      $outcome_reason .= '<div class="title">You found 10
        Supportive Family Members!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 10
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 10);';
        $result = db_query($sql, $staff, $game_user->id);

      }

      break;

    case 130:
    case 131:
    case 132:
    case 133:
    case 134:
    case 135:
    case 136:
    case 137:
    case 138:
    case 139:
      $staff = 6;

      $outcome_reason .= '<div class="title">You found 10
        Supportive Friends!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 10
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 10);';
        $result = db_query($sql, $staff, $game_user->id);

      }

      break;

    case 140:
    case 141:
      $land = 10;

      $outcome_reason .= '<div class="title">You got a deed to a
        Bank!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 142:
    case 143:
      $land = 11;

      $outcome_reason .= '<div class="title">You got a deed to a
        Luxury Car Importer!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 144:
    case 145:
      $land = 12;

      $outcome_reason .= '<div class="title">You got a deed to a
        Manufacturing Plant!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    default:
      $money = $game_user->level * 1000;
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

  }

  return TRUE;

}


function _stlouis_action_open_a_large_present_function(&$outcome_reason,
  $target, &$can_do_again) {

  $fetch_user = '_' . arg(0) . '_fetch_user';
  $game_user = zg_fetch_user();
//    $can_do_again = FALSE;


  switch(mt_rand(30, 151)) {

    case 30:
    case 31:
    case 32:
    case 33:
    case 34:
    case 35:
    case 36:
    case 37:
    case 38:
    case 39:
      $outcome_reason .=
        '<div class="title">You got your energy refilled!</div>';

      $sql = 'update users set energy = energy_max
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
      $money = floor(($game_user->income - $game_user->expenses) * 4);
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
      $outcome_reason .=
        '<div class="title">You got 50 actions!</div>';

      $sql = 'update users set actions = actions + 50
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
      $outcome_reason .=
        '<div class="title">You got 5000 Influence!</div>';

      $sql = 'update users set experience = experience + 5000
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
    case 75:
    case 76:
    case 77:
    case 78:
    case 79:
      $outcome_reason .=
        '<div class="title">You got 10000 Influence!</div>';

      $sql = 'update users set experience = experience + 10000
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
      $land = 7;

      $outcome_reason .= '<div class="title">You got a deed to
        a Used Car Dealership!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 90:
    case 91:
    case 92:
    case 93:
    case 94:
    case 95:
    case 96:
    case 97:
    case 98:
    case 99:
      $land = 8;

      $outcome_reason .= '<div class="title">You got a deed to
        a Department Store!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 100:
    case 101:
    case 102:
    case 103:
    case 104:
    case 105:
    case 106:
    case 107:
    case 108:
    case 109:
      $land = 9;

      $outcome_reason .= '<div class="title">You got a deed to a
        Luxury Home Builder!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 110:
    case 111:
    case 112:
    case 113:
    case 114:
    case 115:
    case 116:
    case 117:
    case 118:
    case 119:
      $equipment = 14;

      $outcome_reason .= '<div class="title">You got 100
        Toastmasters Memberships!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 100
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_equipment_id, fkey_users_id, quantity) values
          (%d, %d, 100);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 120:
    case 121:
    case 122:
    case 123:
    case 124:
    case 125:
    case 126:
    case 127:
    case 128:
    case 129:
      $staff = 2;

      $outcome_reason .= '<div class="title">You found a class of 100
        Political Science Interns!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 100
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 100);';
        $result = db_query($sql, $game_user->id, $staff);

      }

      break;

    case 130:
    case 131:
    case 132:
    case 133:
    case 134:
    case 135:
    case 136:
    case 137:
    case 138:
    case 139:
      $staff = 7;

      $outcome_reason .= '<div class="title">You found 100
        Foreign War Veterans!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 100
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 100);';
        $result = db_query($sql, $staff, $game_user->id);

      }

      break;

    case 140:
    case 141:
    case 142:
    case 143:
      $land = 10;

      $outcome_reason .= '<div class="title">You got a deed to a
        Bank!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 144:
    case 145:
    case 146:
    case 147:
      $land = 11;

      $outcome_reason .= '<div class="title">You got a deed to a
        Luxury Car Importer!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 148:
    case 149:
    case 150:
    case 151:
      $land = 12;

      $outcome_reason .= '<div class="title">You got a deed to a
        Manufacturing Plant!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already own that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    default:
      $money = $game_user->level * 100000;
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

  }

  return TRUE;

}


function _stlouis_action_open_a_giant_present_function(&$outcome_reason,
  $target, &$can_do_again) {

  $fetch_user = '_' . arg(0) . '_fetch_user';
  $game_user = zg_fetch_user();
//    $can_do_again = FALSE;


  switch(mt_rand(30, 139)) {

    case 30:
    case 31:
    case 32:
    case 33:
    case 34:
    case 35:
    case 36:
    case 37:
    case 38:
    case 39:
      $outcome_reason .=
        '<div class="title">You got your energy refilled!</div>';

      $sql = 'update users set energy = energy_max
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
      $money = floor(($game_user->income - $game_user->expenses) * 24);
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
      $outcome_reason .=
        '<div class="title">You got 100 actions!</div>';

      $sql = 'update users set actions = actions + 100
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
      $outcome_reason .=
        '<div class="title">You got 20000 Influence!</div>';

      $sql = 'update users set experience = experience + 20000
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
    case 75:
    case 76:
    case 77:
    case 78:
    case 79:
      $outcome_reason .=
        '<div class="title">You got 50000 Influence!</div>';

      $sql = 'update users set experience = experience + 50000
        where id = %d';
      $result = db_query($sql, $game_user->id);

      break;

    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
      $land = 10;

      $outcome_reason .= '<div class="title">You got a deed to
        a Bank!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 90:
    case 91:
    case 92:
    case 93:
    case 94:
    case 95:
    case 96:
    case 97:
    case 98:
    case 99:
      $land = 11;

      $outcome_reason .= '<div class="title">You got a deed to
        a Luxury Car Importer!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 100:
    case 101:
    case 102:
    case 103:
    case 104:
    case 105:
    case 106:
    case 107:
    case 108:
    case 109:
      $land = 12;

      $outcome_reason .= '<div class="title">You got a deed to a
        Manufacturing Plant!</div>
        <div class="title"><img
          src="/sites/default/files/images/land/stlouis-' . $land .
          '.png"/></div>';

      $sql = 'select quantity from land_ownership
        where fkey_land_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $land, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that business.
      if (!empty($data)) {

        $sql = 'update land_ownership set quantity = quantity + 1
          where fkey_land_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $land, $game_user->id);

      }
      else {

        $sql = 'insert into land_ownership
          (fkey_land_id, fkey_users_id, quantity) values
          (%d, %d, 1);';
        $result = db_query($sql, $land, $game_user->id);

      }

      break;

    case 110:
    case 111:
    case 112:
    case 113:
    case 114:
    case 115:
    case 116:
    case 117:
    case 118:
    case 119:
      $equipment = 20;

      $outcome_reason .= '<div class="title">You got 250
        iPads!</div>
        <div class="title"><img
          src="/sites/default/files/images/equipment/stlouis-' . $equipment .
          '.png"/></div>';

      $sql = 'select quantity from equipment_ownership
        where fkey_equipment_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $equipment, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that equipment.
      if (!empty($data)) {

        $sql = 'update equipment_ownership set quantity = quantity + 250
          where fkey_equipment_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $equipment, $game_user->id);

      }
      else {

        $sql = 'insert into equipment_ownership
          (fkey_equipment_id, fkey_users_id, quantity) values
          (%d, %d, 250);';
        $result = db_query($sql, $equipment, $game_user->id);

      }

      break;

    case 120:
    case 121:
    case 122:
    case 123:
    case 124:
    case 125:
    case 126:
    case 127:
    case 128:
    case 129:
      $staff = 22;

      $outcome_reason .= '<div class="title">You found a forest full of
        250 Environmental Activists!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 250
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 250);';
        $result = db_query($sql, $staff, $game_user->id);

      }

      break;

    case 130:
    case 131:
    case 132:
    case 133:
    case 134:
    case 135:
    case 136:
    case 137:
    case 138:
    case 139:
      $staff = 23;

      $outcome_reason .= '<div class="title">You found a classful of 250
        Press Attachés!</div>
        <div class="title"><img
          src="/sites/default/files/images/staff/stlouis-' . $staff .
          '.png"/></div>';

      $sql = 'select quantity from staff_ownership
        where fkey_staff_id = %d and fkey_users_id = %d;';
      $result = db_query($sql, $staff, $game_user->id);
      $data = db_fetch_object($result);

      // Already have that staff member.
      if (!empty($data)) {

        $sql = 'update staff_ownership set quantity = quantity + 250
          where fkey_staff_id = %d and fkey_users_id = %d;';
        $result = db_query($sql, $staff, $game_user->id);

      }
      else {

        $sql = 'insert into staff_ownership
          (fkey_staff_id, fkey_users_id, quantity) values
          (%d, %d, 250);';
        $result = db_query($sql, $staff, $game_user->id);

      }

      break;

    default:
      $money = $game_user->level * 1000000;
      $outcome_reason .=
        '<div class="title">You got ' . $money . ' ' .
        $game_user->values .'!</div>';

      $sql = 'update users set money = money + %d
        where id = %d';
      $result = db_query($sql, $money, $game_user->id);

      break;

  }

  return TRUE;

}


function _stlouis_action_exploit_your_seat_function(&$outcome_reason,
  $target, &$can_do_again) {

  global $game, $phone_id;

  $fetch_user = '_' . $game . '_fetch_user';
  $game_user = zg_fetch_user();
  $can_do_again = FALSE;

  $next_major_action_time =
    zg_get_value($game_user, 'next_major_action', 0);

  // Egads! Hacking!
  if ($next_major_action_time > REQUEST_TIME) {

    game_user($game_user, "Exploiting seat too soon!", -50);

    $outcome_reason = '<div class="title error">--&gt; h4x0r &lt;--</div>';

    return FALSE;

  }

  // Time waster.
  if (mt_rand(0, 9) == 0) {

    $outcome_reason .= '<div class="title">But... your time
      was completely wasted</div>
      <div class="title"><img
        src="/sites/default/files/images/stlouis-frustrated-official.png"/>
      </div>
      <div class="subtitle">That\'s 45 minutes that you will never
      get back</div>';

    zg_set_timer($game_user, 'next_major_action', 2700);

    return TRUE;

  }


  if ($game_user->level > 100) {
    $equipment = 37;

    // secs for major action
    $major_action_timer = 900;
  }
  else if ($game_user->level > 50) {
    $equipment = 36;

    // Secs for major action.
    $major_action_timer = 600;
  }
  else {
    $equipment = 35;

    // Secs for major action.
    $major_action_timer = 360;
  }


  $outcome_reason .= '<div class="title">You got a present!</div>
    <div class="title"><img
      src="/sites/default/files/images/equipment/stlouis-' . $equipment .
      '.png"/></div>';

  $sql = 'select quantity from equipment_ownership
    where fkey_equipment_id = %d and fkey_users_id = %d;';
  $result = db_query($sql, $equipment, $game_user->id);
  $data = db_fetch_object($result);

  // Already have that equipment.
  if (!empty($data)) {

    $sql = 'update equipment_ownership set quantity = quantity + 1
      where fkey_equipment_id = %d and fkey_users_id = %d;';
    $result = db_query($sql, $equipment, $game_user->id);

  }
  else {

    $sql = 'insert into equipment_ownership
      (fkey_equipment_id, fkey_users_id, quantity) values
      (%d, %d, 1);';
    $result = db_query($sql, $equipment, $game_user->id);

  }

  zg_set_value($game_user, 'next_major_action',
    REQUEST_TIME + $major_action_timer);

  return TRUE;

}
